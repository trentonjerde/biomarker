---
title: "Biomarker: Exploratory Analysis"
output: html_notebook
---

Read in the two data files that have bold signal values for all subjects four values each of frequency and voltage. The columns in each dataset are somewhat different.

```{r data read, message=FALSE, warning=FALSE}
data <- sapply(
  list.files(
    file.path(
      "/Users/trentonjerde/ds_stuff/projects/biomarker", "data"
    ), 
    pattern = "data_", full.names = TRUE
  ), 
  read.csv
)

data.freq <-
  data[[1]]

data.volt <-
  data[[2]]

rm(data)
```

```{r column properties}
# multi.fun <- function(x) {
#   c(min = min(x), mean = mean(x), max = max(x))
# }

m.sapply <- function(...) {
  arglist <- match.call(expand.dots = FALSE)$...
  var.names <- sapply(arglist, deparse)
  has.name <- (names(arglist) != "")
  var.names[has.name] <- names(arglist)[has.name]
  arglist <- lapply(arglist, eval.parent, n = 2)
  x <- arglist[[1]]
  arglist[[1]] <- NULL
  result <- sapply(arglist, function (FUN, x) sapply(x, FUN), x)
  colnames(result) <- var.names[-1]
  return(result)
}

p.cpl <- function(x) {
  round(sum(!is.na(x)) / length(x) * 100, 1)
}
n.unq <- function(x) {
  length(unique(x))
}
mn <- function(x) {
  if (class(data.freq$run1) %in% c("numeric", "integer")) {
    return(round(min(x, na.rm = TRUE), 1))
  } else {
    return(NA)
  }
}
med <- function(x) {
  if (class(data.freq$run1) %in% c("numeric", "integer")) {
    return(round(median(x, na.rm = TRUE), 1))
  } else {
    return(NA)
  }
}
mx <- function(x) {
  if (class(data.freq$run1) %in% c("numeric", "integer")) {
    return(round(max(x, na.rm = TRUE), 1))
  } else {
    return(NA)
  }
}

col.prop <- function(x) {
  res <- as.data.frame(
    m.sapply(x, p.cpl, n.unq, class, mn, med, mx)
  )
  res <- res %>% 
    mutate(col = rownames(res)) %>% 
    select(col, everything())
  name <- paste0(deparse(substitute(x)), "_col.csv")
  print(name)
  write_csv(res, name)
}

col.prop(data.freq)
col.prop(data.volt)

rm(col.prop, m.sapply, med, mn, mx, n.unq, p.cpl)

# write_feather(data.freq, "data.freq.feather")
data.freq <- read_feather("data.freq.feather")
# write_feather(data.volt, "data.volt.feather")
data.volt <- read_feather("data.volt.feather")
```

```{r data}
data.freq <-
  data.freq %>% 
  mutate(group = "frequency")

data.volt <- 
  data.volt %>% 
  rename(voltage = volt) %>% 
  mutate(freq = 130L) %>% 
  mutate(group = "voltage")

data <- 
  bind_rows(
    data.freq, 
    select_(data.volt, .dots = names(data.freq))
  ) %>% 
  select(group, everything()) %>% 
  rename(dbs = dbsOnOff) %>% 
  mutate(dbs = if_else(dbs == 2, 0, 1))

data <-
  data %>%
  gather(run, bold, run1:run8) %>% 
  mutate(run = as.integer(substr(run, 4, 4)))

rm(data.freq, data.volt)
```

```{r}
plot.data <- 
  data %>% 
  mutate(dbs = as.factor(dbs)) %>% 
  filter(group == "voltage") %>% 
  filter(subj == 635 & area == 1 & contact == 2 & voltage == 3)

ggplot(plot.data, aes(x = bold)) +
  geom_density(
    aes(group = dbs, colour = dbs, fill = dbs),
    alpha = 0.3
  )
```

